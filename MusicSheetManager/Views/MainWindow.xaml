<Window x:Class="MusicSheetManager.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:viewModels="clr-namespace:MusicSheetManager.ViewModels"
        xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
        xmlns:models="clr-namespace:MusicSheetManager.Models"
        xmlns:converters="clr-namespace:MusicSheetManager.Converters"
        xmlns:componentModel="clr-namespace:System.ComponentModel;assembly=WindowsBase"
        xmlns:ad="https://github.com/Dirkster99/AvalonDock"
        xmlns:wpf="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        mc:Ignorable="d"
        x:Name="MainWindowRoot"
        d:DataContext="{d:DesignInstance Type=viewModels:MainWindowViewModel}"
        Title="MusicSheetManager" Height="1024" Width="1280"
        WindowStartupLocation="CenterScreen"
        Loaded="MainWindow_OnLoaded">
    <Window.Resources>
        <converters:FirstLetterConverter x:Key="FirstLetterConverter" />
        <CollectionViewSource x:Key="GroupedMusicSheetFolders" Source="{Binding MusicSheetTab.MusicSheetFolders}">
            <CollectionViewSource.GroupDescriptions>
                <PropertyGroupDescription PropertyName="Title" Converter="{StaticResource FirstLetterConverter}" />
            </CollectionViewSource.GroupDescriptions>
            <CollectionViewSource.SortDescriptions>
                <componentModel:SortDescription PropertyName="Title" />
            </CollectionViewSource.SortDescriptions>
        </CollectionViewSource>

        <ContextMenu x:Key="MusicSheetFolderContextMenu">
            <!-- ReSharper disable once Xaml.BindingWithContextNotResolved -->
            <MenuItem Header="Import sheets" 
                      Command="{Binding DataContext.MusicSheetTab.ImportSheetsCommand, Source={x:Reference MainWindowRoot}}"
                      CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}" />
            <!-- ReSharper disable once Xaml.BindingWithContextNotResolved -->
            <MenuItem Header="Assign sheets to people" 
                      Command="{Binding DataContext.MusicSheetTab.AssignMusicSheetsCommand, Source={x:Reference MainWindowRoot}}"
                      CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}" />
            <Separator />
            <!-- ReSharper disable once Xaml.BindingWithContextNotResolved -->
            <MenuItem Header="Open in Windows Explorer" 
                      Command="{Binding DataContext.MusicSheetTab.OpenInExplorerCommand, Source={x:Reference MainWindowRoot}}"
                      CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}" />
            <Separator />
            <!-- ReSharper disable once Xaml.BindingWithContextNotResolved -->
            <MenuItem Header="Copy music sheet folder ID" 
                      Command="{Binding DataContext.MusicSheetTab.CopyFolderIdCommand, Source={x:Reference MainWindowRoot}}"
                      CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}" />
        </ContextMenu>

        <HierarchicalDataTemplate x:Key="MusicSheetTemplate" DataType="{x:Type models:MusicSheet}">
            <StackPanel Orientation="Horizontal" Margin="0,2,10,2">
                <Image Source="/Resources/music-sheet.png" Width="22" Height="22" Margin="0,0,4,0" VerticalAlignment="Center" />
                <TextBlock Text="{Binding}" VerticalAlignment="Center" />
            </StackPanel>
        </HierarchicalDataTemplate>

        <HierarchicalDataTemplate x:Key="MusicSheetFolderTemplate" DataType="{x:Type models:MusicSheetFolder}" ItemsSource="{Binding Sheets}" ItemTemplate="{StaticResource MusicSheetTemplate}">
            <StackPanel Orientation="Horizontal" Margin="0,2,10,2" ContextMenu="{StaticResource MusicSheetFolderContextMenu}">
                <StackPanel.InputBindings>
                    <MouseBinding MouseAction="LeftDoubleClick" Command="{Binding DataContext.MusicSheetTab.AssignMusicSheetsCommand, ElementName=MainWindowRoot}" CommandParameter="{Binding}" />
                </StackPanel.InputBindings>
                <Image x:Name="FolderIcon" Source="/Resources/folder.png" Width="22" Height="22" Margin="0,0,4,0" VerticalAlignment="Center" />
                <TextBlock Text="{Binding Title}" Width="200" FontWeight="SemiBold" Margin="0,0,20,0" VerticalAlignment="Center" />
                <TextBlock x:Name="CreditsTextBlock" Text="{Binding Credits}" Foreground="Gray" FontStyle="Italic" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" />
            </StackPanel>
            <HierarchicalDataTemplate.Triggers>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=TreeViewItem}, Path=IsSelected}" Value="True">
                    <Setter TargetName="CreditsTextBlock" Property="Foreground" Value="White" />
                </DataTrigger>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=TreeViewItem}, Path=IsExpanded}" Value="True">
                    <Setter TargetName="FolderIcon" Property="Source" Value="/Resources/folder-open.png" />
                </DataTrigger>
            </HierarchicalDataTemplate.Triggers>
        </HierarchicalDataTemplate>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Menu VerticalAlignment="Top" Grid.Row="0">
            <MenuItem Header="File">
                <MenuItem Header="Import music sheets..." Click="ImportButton_Click">
                    <MenuItem.Icon>
                        <Image Source="/Resources/import.png" Width="16" Height="16" />
                    </MenuItem.Icon>
                </MenuItem>
                <Separator />
                <MenuItem Header="Exit" Click="ExitMenuItem_Click"/>
            </MenuItem>
            <MenuItem Header="Edit"/>
            <MenuItem Header="Tools">
                <MenuItem Header="Split pages form A3 to A4" Command="{Binding Tools.SplitA3ToA4Command}" />
                <MenuItem Header="Rotate pages" Command="{Binding Tools.RotatePagesCommand}" />
                <Separator />
                <MenuItem Header="Distribute Sheets" Command="{Binding Tools.DistributeSheetsCommand}" />
                <Separator />
                <MenuItem Header="Export part distribution" Command="{Binding Tools.ExportPartDistributionCommand}" />
            </MenuItem>
            <MenuItem Header="Info"/>
        </Menu>

        <ToolBarTray Grid.Row="1">
            <ToolBar>
                <Button Click="ImportButton_Click" ToolTip="Import music sheets">
                    <StackPanel Orientation="Horizontal">
                        <Image Source="/Resources/import.png" Width="16" Height="16" Margin="0,0,4,0" />
                        <TextBlock Text="Import" VerticalAlignment="Center" />
                    </StackPanel>
                </Button>
            </ToolBar>
        </ToolBarTray>

        <ad:DockingManager Grid.Row="2">
            <DockingManager.Theme>
                <ad:Vs2013BlueTheme />
            </DockingManager.Theme>
            <ad:LayoutRoot>
                <ad:LayoutPanel Orientation="Horizontal">
                    <ad:LayoutDocumentPaneGroup>
                        <ad:LayoutDocumentPane>
                            <ad:LayoutDocument Title="Music sheets" CanFloat="False" CanClose="False">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <TreeView ItemsSource="{Binding Source={StaticResource GroupedMusicSheetFolders}}"
                                              ItemTemplate="{StaticResource MusicSheetFolderTemplate}"
                                              Grid.Row="0"
                                              x:Name="MusicSheetTreeView"
                                              SelectedItemChanged="MusicSheetTreeView_OnSelectedItemChanged"
                                              PreviewMouseRightButtonDown="MusicSheetTreeView_OnPreviewMouseRightButtonDown">
                                        <TreeView.Resources>
                                            <Style TargetType="{x:Type GroupItem}">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="{x:Type GroupItem}">
                                                            <Expander IsExpanded="True" Margin="0,0,0,10">
                                                                <Expander.Header>
                                                                    <!-- ReSharper disable once Xaml.BindingWithContextNotResolved -->
                                                                    <TextBlock Text="{Binding Name}" FontWeight="Bold" FontSize="14" />
                                                                </Expander.Header>
                                                                <ItemsPresenter Margin="17,0,0,0" />
                                                            </Expander>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </TreeView.Resources>
                                        <TreeView.GroupStyle>
                                            <GroupStyle ContainerStyle="{StaticResource {x:Type GroupItem}}" />
                                        </TreeView.GroupStyle>
                                    </TreeView>
                                </Grid>
                            </ad:LayoutDocument>

                            <ad:LayoutDocument Title="Playlists" CanFloat="False" CanClose="False">
                                <Grid/>
                            </ad:LayoutDocument>

                            <ad:LayoutDocument Title="Peoples" CanFloat="False" CanClose="False">
                                <Grid>
                                    <ListView ItemsSource="{Binding PeopleTab.People}"
                                              SelectionChanged="PeopleListView_OnSelectionChanged">
                                        <ListView.View>
                                            <GridView>
                                                <GridViewColumn DisplayMemberBinding="{Binding FirstName}" Width="120">
                                                    <GridViewColumnHeader Content="Firstname" HorizontalContentAlignment="Left" Padding="6,0,0,0" />
                                                </GridViewColumn>
                                                <GridViewColumn DisplayMemberBinding="{Binding LastName}" Width="120">
                                                    <GridViewColumnHeader Content="Lastname" HorizontalContentAlignment="Left" Padding="6,0,0,0" />
                                                </GridViewColumn>
                                                <GridViewColumn DisplayMemberBinding="{Binding Instrument.DisplayName}" Width="180">
                                                    <GridViewColumnHeader Content="Instrument" HorizontalContentAlignment="Left" Padding="6,0,0,0" />
                                                </GridViewColumn>
                                                <GridViewColumn DisplayMemberBinding="{Binding Part.DisplayName}" Width="60">
                                                    <GridViewColumnHeader Content="Part" HorizontalContentAlignment="Left" Padding="6,0,0,0" />
                                                </GridViewColumn>
                                                <GridViewColumn DisplayMemberBinding="{Binding Clef.DisplayName}" Width="60">
                                                    <GridViewColumnHeader Content="Clef" HorizontalContentAlignment="Left" Padding="6,0,0,0" />
                                                </GridViewColumn>
                                            </GridView>
                                        </ListView.View>
                                    </ListView>
                                </Grid>
                            </ad:LayoutDocument>
                        </ad:LayoutDocumentPane>
                    </ad:LayoutDocumentPaneGroup>

                    <ad:LayoutAnchorablePaneGroup DockWidth="400">
                        <ad:LayoutAnchorablePane>
                            <ad:LayoutAnchorable Title="Properties" CanFloat="False" CanClose="False" CanHide="True" AutoHideMinWidth="200">
                                <xctk:PropertyGrid SelectedObject="{Binding SelectedObject}" />
                            </ad:LayoutAnchorable>
                            <ad:LayoutAnchorable Title="PDF Viewer" CanFloat="False" CanClose="False" CanHide="True" AutoHideMinWidth="200">
                                <Grid Background="#333333">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*" />
                                    </Grid.RowDefinitions>
                                    <wpf:WebView2 x:Name="PdfViewer" Grid.Row="0" />
                                </Grid>
                            </ad:LayoutAnchorable>
                        </ad:LayoutAnchorablePane>
                    </ad:LayoutAnchorablePaneGroup>
                </ad:LayoutPanel>
            </ad:LayoutRoot>
        </ad:DockingManager>
    </Grid>
</Window>
